\clearpage

\section{Curvas elípticas sobre cuerpos finitos}
\label{sec:Curvas elípticas sobre cuerpos finitos}

% TODO: reformular
Sea $\Fq$ un cuerpo finito de $q$ elementos, donde $q$ es la potencia $n$-ésima de un primo $p$ y sea $E$ una curva elíptica definida sobre $\Fq$. Como el número de pares $(x, y)$ con $x, y \in \Fq$ es finito, el grupo de puntos $E(\Fq)$ es finito. En este aparatado estudiaremos las propiedades de este grupo, como el orden, que serán importantes en muchos contextos.

% TODO: ver como dejar
% Dos principales restricciones de los grupos $E(\Fq)$ se dan en los siguientes dos teoremas.
Los dos resultados más importantes se dan en los siguientes dos teoremas.

\begin{teorema}\label{th:estructura grupo puntos}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$. Entonces
	$$
		E(\Fq) \simeq \mathbb{Z}_n \textrm{ or } \mathbb{Z}_{n_1} \oplus \mathbb{Z}_{n_2}
	$$
	para algún entero $n \ge 1$ o para algunos enteros $n_1, n_2 \ge 1$ con $n_1 \mid n_2$.
\end{teorema}
\begin{proof}
Como $E(\Fq)$ es un grupo abeliano finito, será isomorfo a una suma directa de grupos cíclicos
$$
	\mathbb{Z}_{n_1} \oplus \mathbb{Z}_{n_2} \oplus \dots \mathbb{Z}_{n_r}
$$
con $n_i \mid n_{i+1}$. Como, para cada $i$, el grupo $Z_{n_i}$ tiene $n_1$ elementos de orden un divisor de $n_1$, tenemos que $E(\Fq)$ tiene $n_1^r$ elementos de orden un divisor de $n_1$. Por el teorema~\ref{th:estructura subgrupos torsión}, hay hasta $n_1^2$ (incluso si permitimos coordenadas en la clasura algebraica de $\Fq$). Por tanto, $r \le 2$.
\end{proof}

\begin{teorema}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$. Entonces el orden de $E(\Fq)$ verifica
	$$
		|q + 1 - \left\vert{E(\F_{q})}\right\vert| \le 2 \sqrt{q}.
	$$
\end{teorema}
\begin{proof}
	Véase apartado~\ref{sub:Teorema de Hasse}.
\end{proof}


\subsection{Ley de grupo para cuerpos base de característica 2}

%TODO: intro
%TODO: poner tambien las supersingulares?
En el apartado~\ref{sub:Ley de grupo} vimos las formulas de adicción cuando la característica del cuerpo base era distinta de 2 y 3. Como los cuerpos finitos de característica 2 son interesante a nivel computacional, presentamos aquí las fórmulas de adicción para las curvas no supersingulares (véase ~\ref{lm:ecuaciones curva eliptica caracteristica dos}), ya que no es recomendable usar curvas supersingulares en criptografía (véase ~\ref{}).

\begin{formulasadiccion}
Sea $E$ una curva elíptica definida por la ecuación $y^2 + x y = x^3 + a x^2 + b$ sobre el cuerpo finito $\Fm$. Las fórmulas de adicción son las siguientes:
	\begin{enumerate}[label=\alph*)]
	   \item $P + \infty = \infty + P = P,$ para todo $P \in E(\Fm)$
	   \item Si $P = (x, y) \in E(\Fm)$, entonces $(x, y) + (x, x + y) = \infty$ ya que $-P = (x, x + y)$. Además, $- \infty = \infty$.
	   \item Sea $P = (x_1, y_1) \in E(\Fm)$ y $Q = (x_2, y_2) \in E(\Fm)$, donde $P \neq \pm Q$. Entonces $P + Q = (x_3, y_3)$, donde
	   $$
	   x_3 = \lambda^2 \lambda + x_1 + x_2 + a, \quad
	   y_3 = \lambda (x_1 + x_3) + x_3 + y_1
	   $$
	   con $\lambda = (y_1 + y_2)/(x_1 + x_2)$.
	   \item Sea $P = (x_1, y_1) \in E(\Fm)$, donde $P \neq -P$. Entonces $2 P = (x_3, y_3)$ donde:
	   $$
	   x_3 = \lambda^2 \lambda + a = x_1^2 + b/x_1^2, \quad
	   y_3 = x_1^2 + \lambda x_3 + x_3
	   $$
	   con $\lambda = x_1 + y_1/x_1$.
	\end{enumerate}
\end{formulasadiccion}

% TODO: rellenar ref y ver que hacer
% Vimos en el apartado~\ref{sub:Ecuaciones de Weierstrass simplificadas} que la ecuación de una curva elíptica definida sobre $\Fm$ podía simplificarse de dos formas, dado curvas supersingulares y no supersingulares (véase ~\ref{}). Puesto que las curvas supersingulares no se utilizan en criptografía (véase ~\ref{}), trabajaremos sobre las no supersingulares. Las fórmulas de adicción para este tipo de curvas, cuya ecuación simplificada era  $y^2 + xy = x^3 + a x^2 + b$, son las siguientes:
%
% Análogamente a~\ref{th:grupo abeliano}, se puede probar que el conjunto $E(\Fm)$ junto con la operación anterior definida es un grupo abeliano.
%
% \begin{teorema}
% 	La suma~\ref{def:ley de grupo Fm} de puntos en una curva elíptica $E$ sobre el cuerpo $\Fm$ satisface la siguientes propiedades:
% 	\begin{itemize}
% 		\item \emph{Conmutatividad}: $$P_1 + P_2 = P_2 + P_1,\ \forall P_1, P_2 \in E(\Fm).$$
% 		\item \emph{Existencia de elemento neutro}: $$P + \infty = P,\ \forall P \in E(\Fm).$$
% 		\item \emph{Existencia de elemento opuesto}: $$P + (-P) = \infty,\ \forall P \in E(\Fm).$$
% 		\item \emph{Asociatividad}: $$(P_1 + P_2) + P_3 = P_1 + (P_2 + P_3), \ \forall P_1, P_2, P_3 \in E(\Fm).$$
% 	\end{itemize}
% 	En otras palabras, $(E(\Fm), +, \infty)$ es un grupo abeliano.
% \end{teorema}


\subsection{Endomorfismo de Frobenius}
\label{sub:Endomorfismo de Frobenius}

En este apartado veremos un ejemplo importante de endomorfismo. Jugará una papel crucial en la teoría de curvas elípticas sobre cuerpos finitos.

\begin{proposicion}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$. La aplicación definida por
	$$
		\phi_q(x, y) = (x^q, y^q), \quad \phi_q(\infty) = \infty
	$$
	es un endomorfismo y se llama \emph{endormofirsmo de Frobenius}.
\end{proposicion}
\begin{proof}
Veamos primero que $\phiq(x, y) \in \EFqca$. Usaremos las siguientes propiedades de los cuerpos finitos:
\begin{align*}
	(a + b)^q &= a^q + b^q, \ \forall a, b \in \Fqca \\
	a^q &= a, \ \forall a \in \Fq.
\end{align*}
Como la demostración es esencialmente la misma para la ecuación de Weirstrass general y la ecuación simplificada para cuerpos base de característica distinta de 2 y 3, usaremos está última. Tenemos
$$
	y^2 = x^3 + a x + b,
$$
donde $a, b \in Fq$. Elevando todo a la potencia $q$-ésima obtenemos
$$
	(y^q)^2 = (x^q)^3 + a (x^q) + b.
$$
Luego $(x^q, y^q)$ está en $E$. Veamos ahora $\phiq$ es un homorfismo. Sea $(x_1, y_1), (x_2, y_2) \in \EFqca$ con $x_1 \neq x_2$. La suma es $(x_3, y_3)$ con
$$
	x_3 = m^2 - x_1 - x_2, \ y_3 = m (x_1 - x_3) - y_1, \textrm{ donde } m = \frac{y_2 - y_1}{x_2 - x_1}
$$
Elevando todo a la potencia $q$-ésima obtenemos
$$
	x_3^q = m'^2 - x_1^q - x_2^q, \ y_3^q = m' (x_1^q - x_3^q) - y_1^q, \textrm{ donde } m' = \frac{y_2^q - y_1^q}{x_2^q - x_1^q}.
$$
Por tanto,
$$
	\phiq(x_3, y_3) = \phiq(x_1, y_1) + \phiq(x_2, y_2).
$$
Los casos donde $x_1 = x_2$ o uno de los dos puntos es $\infty$ se comprueban fácilmente. Sin embargo, el caso de añadir un punto consigo mismo presenta una sutileza. Usando las fórmulas, tenemos que $2 (x_1, y_1) = (x_3, y_3)$ donde
$$
	x_3 = m^2 - 2 x_1, \ y_3 = m (x_1 - x_3) - y_1, \textrm{ donde } m = \frac{3 x_1^2 + a}{2 y_1}.
$$
Cuando elevamos a la potencia $q$-ésima, obtenemos
$$
	x_3^q = m'^2 - 2^q x_1^q, \ y_3^q = m' (x_1^q - x_3^q) - y_1^q, \textrm{ donde } m' = \frac{3^q (x_1^q)^2 + a^q}{2^q y_1^q}.
$$
Como $2, 3, a \in \Fq$, tenemos $2^q = 2,\ 3^q = 3,\ a^q = a$. Luego hemos obtenido la fórmula para duplicar el punto $(x_1^q, y_1^q)$ de $E$.

Finalmente, como $\phiq$ es un homomorfismo dado por funciones racionales, es un endomorfismo de $E$.
\end{proof}

% TODO: ver que hacer
% En general, para una curva eliptica arbitraria R definida sobre Fq y una extension F de Fq, el endomorfismo de Frobenius phiq permuta los elementos de E(F) y es la identidad en el subgrupo E(Fq).
Nótese que este endomorfismo no es más que aplicar el \emph{automorfismo de Frobenius}
\begin{align*}
	\Fqca &\to \Fqca \\
	x &\mapsto x^q
\end{align*}
sobre las componentes de un punto. Veamos ahora una cuantas propiedades de este endomorfismo.

\begin{lema}\label{lm:elementos fijos endomorfismo Frobenius}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$ y sea $(x, y) \in \EFqca$. Entonces
	$$
		(x, y) \in E(\Fq) \iff \phiq(x, y) = (x, y).
	$$
\end{lema}
\begin{proof}
Usando $a^q = a, \ \forall a \in \Fq$, tenemos
	\begin{align*}
		(x, y) \in E(\Fq) &\iff x, y \in \Fq \\
			&\iff \phiq(x) = x \textrm{ y } \phiq(y) = y \\
			&\iff \phiq(x, y) = (x, y).
	\end{align*}
\end{proof}

\begin{lema}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$. Entonces $\phi_q$ no es separable y es de grado $q$.
\end{lema}
\begin{proof}

Como $q = 0$ en $\Fq$, la derivada de $x^q$ es idénticamente cero, luego $\phiq$ no es separable. Por otro lado, $\phiq$ tiene grado $q$ aplicando la definición de grado de un endomorfismo.
\end{proof}

% TODO: rebajar a lema?
\begin{proposicion}\label{pp:separabilidad endomorfismo frobenius menos uno}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$, donde $q$ es una potencia de un primo $p$. Sean $r, s$ enteros no nulos. El endomorfismo $r \phi_q + s$ es separable si y solo si $p \nmid s$.
\end{proposicion}
\begin{proof}
Podemos escribir el endomorfismo multiplicación por $r$ como
$$
	r(x, y) = (R_r(x), y S_r(x))
$$
por el lema~\ref{lm:endomorfismo con funciones racionales}. Entonces
\begin{align*}
	(R_{r \phiq}(x), y S_{r \phiq}(x)) &= (\phiq r) ( x, y) = (R_r^q(x), y^q S_r^q(x)) \\
	&= (R_r^q(x), y(x^3 + a x + b)^{(q-1)/2} S_r^q(x)).
\end{align*}
Así,
$$
	c_{r \phiq} = R_{r \phiq}' / S_{r \phiq} = q R_r^{q - 1} R_r' / S_{r \phiq} = 0.
$$
Además, $c_s = R_s' / S_s = s$ por la proposición~\ref{pp:endomorfismo multiplicación}. Por el lema~\ref{lm:cociente derivadas funciones racionales},
$$
	R_{r \phiq + s}' / S_{r \phiq + s} = c_{r \phiq + s} = c_{r \phiq} + c_{s} = 0 + s = s
$$
Por lo tanto, $r \phi_q + s$ es separable si y solo si $R_{r \phiq + s}' \neq 0$ y esto ocurre si y solo si $p \nmid s$.
\end{proof}

\begin{proposicion}\label{pp:relacion nucleo y endomorfismo Frobenius}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$ y consideremos el endomorfismo $\phiq^n - 1$ con $n \ge 1$. Entonces
	\begin{enumerate}
		\item $\ker(\phiq^n - 1) = E(\F_{q^n})$.
		\item $\phiq^n - 1$ es separable, por lo que $\left\vert{E(\F_{q^n})}\right\vert = \deg(\phiq^n - 1)$.
	\end{enumerate}
\end{proposicion}
\begin{proof}
Como $\phiq^n$ es el endomorfismo de Frobenius para el cuerpo $\F_{q^n}$, (1) es consecuencia del lema~\ref{lm:elementos fijos endomorfismo Frobenius}. (2) se tiene aplicando las proposiciones~\ref{pp:separabilidad endomorfismo frobenius menos uno} y~\ref{pp:cardinal del núcleo}.
\end{proof}

\begin{lema}\label{lm:descomposicion grado frobenius}
	Sean $r, s$ enteros. Entonces $\deg(r \phi_q - s) = r^2 q + s^2 - rsa$.
\end{lema}
\begin{proof}
La proposición~\ref{pp:grado endomorfismo a*alpha + b*beta} implica que
\begin{align*}
	\deg(r \phi_q - s) =& \ r^2 \deg(\phiq) + s^2 \deg(-1) \\
	&+ r s (\deg(\phiq - 1) - \deg(\phiq) - \deg(-1)).
\end{align*}
Como $\deg(\phiq) = q$ y $\deg(-1) = 1$, el resultado se deduce de~\ref{pp:relacion nucleo y endomorfismo Frobenius} y~\ref{th:estructura grupo puntos}.
\end{proof}

\subsection{Teorema de Hasse}
\label{sub:Teorema de Hasse}

Podemos ya probar el teorema de Hasse.

\begin{teorema}
	Sea $E$ una curva elíptica definida sobre un cuerpo finito $\Fq$. Entonces el orden de $E(\Fq)$ verifica
	$$
		|q + 1 - \left\vert{E(\F_{q})}\right\vert| \le 2 \sqrt{q}.
	$$
\end{teorema}
\begin{proof}
Sea
$$
	a = q + 1 - \left\vert{E(\F_{q})}\right\vert = q + 1 - deg(\phiq - 1)
$$
donde estamos usando proposición~\ref{pp:relacion nucleo y endomorfismo Frobenius}. Veamos que $|a| \le 2 \sqrt{q}$.

Como $\deg(r \phi_q - s) \ge 0$, el lema~\ref{lm:descomposicion grado frobenius} implica que
$$
q \left( \frac{r}{s} \right)^2 - a \left(\frac{r}{s} \right) ^2 + 1 \ge 0.
$$
para cualesquiera enteros $r, s$. Como el conjunto de los racionales es \emph{denso} en $\mathbb{R}$, tenemos que
$$
q x^2 - a x + 1 \ge 0
$$
para todo número real $x$. Así, el discriminante de este polinomio es negativo o cero, lo que implica que $a^2 - 4 q \le 0$, luego $| a | \le 2 \sqrt{q}$.
\end{proof}

En la anterior demostración, han sido esenciales tres ingredientes:
\begin{itemize}
	\item La identificación de $E(\Fq)$ con el núcleo de $\phiq - 1$.
	\item La igualdad entre el orden del núcleo y el grado de $\phiq - 1$ gracias a la separabilidad de $\phiq - 1$
	\item El emparejamiento Weil, especialmente la parte (6) del teorema~\ref{pp:endomorfismo Weil} y su consecuencia~\ref{pp:relacion nucleo y endomorfismo Frobenius}.
\end{itemize}

% Nótese que hay varios ingredientes esenciales en la demostración. El primero es que estamos identicando $E\
